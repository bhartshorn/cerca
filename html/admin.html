{{ template "head" . }}
<main>
    <h1>{{ .Title }}</h1>
    <section>
        <form method="GET" id="add-user" action="/add-user"></form>
        <p>
        <form method="POST" id="demote-self" action="/demote-admin">
            <input type="hidden" name="userid" value="{{ .LoggedInID }}">
        </form>
        <p>
        Does someone wish admittance? You can <button form="add-user" type="submit">Add new user</button>.
        </p>
        <p>
        If you want to stop being an admin, you can <button form="demote-self" type="submit">Step down</button>.
        </p>
        <p>
        View past actions in the <a href="/moderations">moderation log</a>.
        </p>
    </section>
    {{ if .LoggedIn }}
    <section>
        <h2> Admins </h2>
        {{ if len .Data.Admins | eq 0 }} 
            <p> there are no admins; chaos reigns </p>
        {{ else }}
            {{ $userID := .LoggedInID }}
            {{ range $index, $user := .Data.Admins }}
            <form method="POST" id="demote-admin-{{$user.ID}}" action="/demote-admin">
            <input type="hidden" name="userid" value="{{ $user.ID }}">
            </form>
            <p> {{ $user.Name }} ({{ $user.ID }}) 
            {{ if eq $userID $user.ID }} <i>(this is you!)</i> 
            {{ else }}<button type="submit" form="demote-admin-{{$user.ID}}">Demote</button>{{ end }}
            </p>
            {{ end }}
        {{ end }}
    </section>

    <section>
        <h2> Users </h2>
        {{ if len .Data.Users | eq 0 }} 
            <p> there are no other users </p>
        {{ else }}
        <table>
            {{ range $index, $user := .Data.Users }}
            {{ if ne $user.Name "deleted user" }} 
                <form method="POST">
                <input type="hidden" name="userid" value="{{$user.ID}}">
                <tr>
                    <td>{{ $user.Name }} ({{ $user.ID }})</td>
                    <td>
                        <select name="admin-action" action="/admin/" id="select-{{$user.ID}}">
                            <option selected value="reset-password">Reset password</option>
                            <option value="remove-account">Remove account</option>
                            <option value="make-admin">Make admin</option>
                        </select>
                    </td>
                    <td>
                        <button type="submit">Submit</button>
                    </td>
                </tr>
                {{ end }}
            </form>
            {{ end }}
        </table>
        {{ end }}
    </section>

    {{ end }}
</main>
{{ template "footer" . }}
